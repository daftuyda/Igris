<!-- templates/tasks.html -->
{% extends "base.html" %}
{% block content %}

<h2 class="section-title">Your Tasks</h2>
<p class="section-body">{{ completed_count }}/{{ total_tasks }} tasks completed</p>
<div class="tasks-container">

  <!-- Button to create a new task -->
  <a class="system-button create-button" href="{{ url_for('create_task') }}">
    + Create New Task
  </a>

  {% for task in tasks %}
    <div class="task-panel">
      <h3>{{ task.name }}</h3>
      <p>Frequency: <span class="highlight">{{ task.frequency|capitalize }}</span></p>
      <!-- <p>Type: <span class="highlight">{{ task.task_type }}</span></p> -->

      {% if task.task_type == 'boolean' %}
        <!-- Boolean tasks: toggle done or not -->
        <p>Done? 
          {% if task.is_done %}
            <span class="done-yes">Yes</span>
          {% else %}
            <span class="done-no">No</span>
          {% endif %}
        </p>
        <form action="{{ url_for('toggle_task', task_id=task.id) }}" method="POST">
          <button class="system-button small" type="submit">
            {% if task.is_done %}Mark Not Done{% else %}Mark Done{% endif %}
          </button>
        </form>

      {% else %}
        <!-- Count tasks: show progress & update form -->
        <p>Progress: <span class="highlight">{{ task.count }}</span> / {{ task.goal }}</p>
        <div class="progress-bar-container">
          {% set progress = (task.count / task.goal * 100) if task.goal != 0 else 0 %}
          <div class="progress-bar" style="width: {{ progress }}%"></div>
        </div>
        <form action="{{ url_for('update_task', task_id=task.id) }}" method="POST" class="increment-form">
          <input type="number" name="amount" value="1" min="1" class="increment-input">
          <button class="system-button small" type="submit">+ Add</button>
        </form>
      {% endif %}

      <!-- Edit link -->
      <a class="system-link" href="{{ url_for('edit_task', task_id=task.id) }}">Edit Task</a>
    </div>
  {% endfor %}

</div>
{% endblock %}
